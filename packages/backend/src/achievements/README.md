# Система достижений Avalon

Эта директория содержит реализацию системы достижений для игры Avalon.

## Структура

- `index.ts` - основной сервис для работы с достижениями и менеджер достижений
- `handlers.ts` - обработчики событий для достижений
- `data.ts` - данные для инициализации достижений

## Модели данных

Модели данных для достижений определены в `packages/types/stats/achievements.ts`:

- `Achievement` - модель достижения (содержит только id, type, requirement и metadata)
- `UserAchievement` - модель достижения пользователя (содержит прогресс и состояние)
- `AchievementStats` - модель статистики достижений (содержит статистику по каждому достижению)

Тексты и иконки для достижений хранятся на фронтенде, что упрощает локализацию и изменение визуального представления.

## Константы

Константы для идентификаторов достижений определены в `packages/types/stats/achievements-constants.ts`.

## Инициализация

Для инициализации достижений в базе данных используется скрипт `packages/backend/src/scripts/initAchievements.ts`.

```bash
npm run init-achievements
```

## Интеграция с игрой

Система достижений интегрирована с игрой через событие `gameEndedWithState` в `eventBus`. Когда игра завершается, менеджер достижений получает состояние игры и обрабатывает достижения для каждого игрока.

## Достижения

### Открытые достижения

1. **Защитник Камелота** - Выиграть 10 игр на стороне сил света
2. **Агент Мордреда** - Выиграть 10 игр на стороне сил тьмы
3. **Мастер на все руки** - Выиграть на каждой роле из стандартного набора: Мерлин, Персиваль, Мордред, Моргана, Оберон, Сервант, Миньон
4. **Универсальный солдат** - Выиграть игру на 5, 6, 7, 8, 9, 10 человек
5. **Охотник на волшебников** - Убить Мерлина 5 раз
6. **Легенда Авалона** - Стать топ-1 игроком на любой роле

### Скрытые достижения

1. **Агент под прикрытием** - Будучи Мерлином выбрать Моргану дважды на миссию и после этого выиграть игру
2. **Что за бесполезная роль** - 5 раз на Клирике отправить первый поход
3. **Все еще достоин** - Использовать Экскалибур в 5-ом походе и выиграть игру на мирной роле
4. **Сыщик** - Будучи Мерлином проверить лояльность Мордреда при помощи Леди Озера
5. **Ошибки случаются** - Нажать фейл всеми мафиями в походе (в походе только мафии)
6. **Серийный убийца** - Убить хотя бы раз Мерлина, Клирика и любовников
7. **Неправильный выбор** - Будучи Морганой попасть в три провальных похода
8. **Телохранитель** - Получить выстрел будучи Персивалем
9. **Провидец** - Будучи Сервантом собрать все походы без мафии (минимум 3 раза за игру (5-6 игроков) / 2 раза (7+ игроков))

## Дальнейшее развитие

Текущая реализация системы достижений является базовой и может быть расширена в будущем. Вот некоторые возможные улучшения:

1. Реализация методов для получения статистики игрока (количество побед за добрую/злую сторону, количество убийств Мерлина и т.д.)
2. Добавление уведомлений о получении достижений через Socket.io
3. Добавление UI для отображения достижений
4. Добавление новых достижений
5. Улучшение обработки сложных достижений
